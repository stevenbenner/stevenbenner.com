---
import MarkdownIt from 'markdown-it';
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import PostListItem from '../components/PostListItem.astro';

const parser = new MarkdownIt('commonmark');

const allPosts = await getCollection('posts');
const pageTitle = 'Articles';
---

<BaseLayout pageTitle={pageTitle}>
	<ol reversed>
	{
		allPosts.reverse().map((post) => {
			const body = parser.render(post.body);
			const postExcerpt = body.substring(0, body.indexOf('<!-- more -->'));
			return <PostListItem
				url={`/${post.slug}/`}
				title={post.data.title}
				pubDate={post.data.pubDate}
				thumbnail={post.data.image}
				postExcerpt={postExcerpt}
			/>;
		})
	}
	</ol>
</BaseLayout>
